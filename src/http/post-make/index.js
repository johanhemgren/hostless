const{HOST,TXT_KEY_STRING}=require("@architect/shared/constants"),{encrypt,setPassword}=require("@architect/shared/encryption"),{compress}=require("@architect/shared/compression"),{errorPage}=require("@architect/shared/errorPage"),getPostedData=e=>{if(!!e)return JSON.parse(process.env.NODE_ENV!=="testing"?e:Buffer.from(e,"base64").toString("ascii"))},escapeHtml=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");exports.handler=async function(o){console.log(o);const t=getPostedData(o.body);if(!(t==null?void 0:t.title)||!(t==null?void 0:t.hostUrl)||!(t==null?void 0:t.bodyHtml))return errorPage;const{title:a,hostUrl:i,bodyHtml:l,preferedPassword:r}=t,p=r&&r!==""?r:null,s=i.replace(/(^\w+:|^)\/\//,""),h=compress({title:a,bodyHtml:l},s),c=setPassword(p),g=`"${TXT_KEY_STRING}=${escapeHtml(c)}"`,d=await encrypt(h,s,c),n=`http://${s}.${HOST}/ess`,m=`${n}/${encodeURIComponent(d)}`;return{cors:!0,type:"application/json",headers:{"Access-Control-Allow-Origin":"http://localhost:3000","set-cookie":"fiz=buz"},statusCode:200,body:JSON.stringify({urlBase:n,url:m,txtRecord:g})}};
