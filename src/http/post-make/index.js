const{HOST,TXT_KEY_STRING}=require("@architect/shared/constants"),{encrypt,setPassword}=require("@architect/shared/encryption"),{compress}=require("@architect/shared/compression"),{errorPage}=require("@architect/shared/errorPage"),getPostedData=e=>{if(!!e)return JSON.parse(process.env.NODE_ENV!=="testing"?e:Buffer.from(e,"base64").toString("ascii"))},escapeHtml=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");exports.handler=async function(c){console.log(c);const t=getPostedData(c.body);if(!(t==null?void 0:t.title)||!(t==null?void 0:t.hostUrl)||!(t==null?void 0:t.bodyHtml))return errorPage;const{title:a,hostUrl:i,bodyHtml:p,preferedPassword:r}=t,l=r&&r!==""?r:null,s=i.replace(/(^\w+:|^)\/\//,""),g=compress({title:a,bodyHtml:p},s),o=setPassword(l),h=`"${TXT_KEY_STRING}=${escapeHtml(o)}"`,d=await encrypt(g,s,o),n=`http://${s}.${HOST}/ess`,m=`${n}/${encodeURIComponent(d)}`;return{cors:!0,type:"application/json",statusCode:200,body:JSON.stringify({urlBase:n,url:m,txtRecord:h})}};
