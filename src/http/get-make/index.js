const{HOST,TXT_KEY_STRING}=require("@architect/shared/constants"),{encrypt,setPassword}=require("@architect/shared/encryption"),{compress}=require("@architect/shared/compression"),getPostedData=t=>JSON.parse(process.env.NODE_ENV==="production"?t:Buffer.from(t,"base64").toString("ascii")),escapeHtml=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");exports.handler=async function(s){console.log(s);const{title:n,hostUrl:a,bodyHtml:p,preferedPassword:o}=getPostedData(s.body),i=o!==""?o:null,e=a.replace(/(^\w+:|^)\/\//,""),l=compress({title:n,bodyHtml:p},e),r=setPassword(i),d=`"${TXT_KEY_STRING}=${escapeHtml(r)}"`,u=await encrypt(l,e,r),c=`http://${e}.${HOST}/ess`,g=`${c}/${encodeURIComponent(u)}`;return{cors:!0,type:"application/json",statusCode:200,body:JSON.stringify({urlBase:c,url:g,txtRecord:d})}};
